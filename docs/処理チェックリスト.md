# 純鬼 処理チェックリスト

> 実装すべき処理をチェックリスト形式で整理。開発進捗の管理に利用してください。

---

## 進捗サマリ（更新日時はファイル保存時に更新）

| Phase | 内容 | 状態 |
|-------|------|------|
| 1 | 環境構築・基盤 | ✅ 完了 |
| 2 | マップ・プレイヤー | 未着手 |
| 3 | 純鬼（敵） | 未着手 |
| 4 | アイテム・謎解き | 未着手 |
| 5 | イベント・ストーリー | 未着手 |
| 6 | DB・セーブ | 未着手 |
| 7 | サウンド・演出 | 未着手 |
| 8 | UI・エンディング | タイトル表示のみ完了、メニュー・エンディングは未着手 |
| 9 | テスト・調整 | 未着手 |

**次に進めるとよい項目**: Phase 2（マップ・プレイヤー）または Phase 8.2 の「はじめる」「つづきから」メニュー。

---

## Phase 1：環境構築・基盤

### 1.1 プロジェクト初期化
- [x] venv 仮想環境の作成・有効化（README 手順）
- [x] Pygame のインストール（`pip install -r requirements.txt`）
- [x] ディレクトリ構成の作成（`src/`, `assets/images/`, `assets/sounds/`, `assets/fonts/`, `data/`）
- [x] `main.py` から Pygame ウィンドウを起動できることを確認

### 1.2 ゲーム起動処理
- [x] Pygame の初期化（`pygame.init()`）
- [x] ディスプレイ作成（1280x720、ウィンドウモード）
- [x] ゲームループの骨格（`while running`）
- [x] フレームレート制御（60 FPS、`pygame.time.Clock().tick(60)`）
- [x] 終了処理（`pygame.quit()`）

### 1.3 定数・設定
- [x] 画面サイズ、色、FPS などの定数をまとめたモジュール作成（`src/config.py`）
- [x] 設定の外部化（Python 定数ファイルで実施）

---

## Phase 2：マップ・プレイヤー

### 2.1 マップ表示処理
- [ ] マップデータの定義（2D 配列 or タイルマップ）
- [ ] マップの描画処理
- [ ] カメラ・スクロール（プレイヤーを中心にした表示）
- [ ] 部屋・廊下の区切り表現（壁、床）
- [ ] マップ切替（部屋間の移動）

### 2.2 衝突判定
- [ ] 壁との衝突判定（プレイヤーが壁を突き抜けない）
- [ ] ドア・扉の判定（鍵が必要な扉）
- [ ] マップ遷移トリガー（部屋の出入口）

### 2.3 プレイヤー処理
- [ ] プレイヤースプライトの表示（仮画像で可）
- [ ] キーボード入力の取得（矢印キー or WASD）
- [ ] プレイヤーの移動処理（上下左右）
- [ ] プレイヤーの位置更新とマップ座標との同期
- [ ] 歩行アニメーション（任意）

---

## Phase 3：純鬼（敵）

### 3.1 純鬼の基本処理
- [ ] 純鬼スプライトの表示（白い人型、仮画像で可）
- [ ] 純鬼の初期位置・出現位置の定義
- [ ] 純鬼の移動処理（基本的な座標更新）

### 3.2 純鬼の追跡 AI
- [ ] プレイヤーとの距離計算
- [ ] プレイヤーに向かう経路・方向の計算
- [ ] 純鬼の移動速度（プレイヤーより遅く、ゆっくり追跡）
- [ ] マップの壁を考慮した移動（障害物回避 or 単純追跡）
- [ ] 出現タイミング（アイテム取得直後、謎解き後など「油断した瞬間」）

### 3.3 純鬼との接触
- [ ] プレイヤーと純鬼の当たり判定（矩形 or 円形）
- [ ] 接触時のゲームオーバー処理
- [ ] ゲームオーバー画面の表示
- [ ] コンティニュー or タイトルに戻る処理

### 3.4 純鬼の特殊挙動
- [ ] 純鬼が特定の部屋にのみ出現する条件分岐
- [ ] 主な純鬼と小純鬼の種類分け（オプション）
- [ ] トゥルーエンド用「意図的に触れる」選択肢のトリガー

---

## Phase 4：アイテム・謎解き

### 4.1 アイテム基本処理
- [ ] アイテムのデータ構造定義（ID、名前、取得可能フラグ）
- [ ] アイテムのマップ上配置
- [ ] プレイヤーとアイテムの接触判定
- [ ] アイテム取得時の処理（インベントリに追加）
- [ ] インベントリの管理（所持アイテム一覧）
- [ ] アイテム使用処理（鍵で扉を開けるなど）

### 4.2 主要アイテムの実装
- [ ] 懐中電灯（取得後、視界・照明効果）
- [ ] 古い鍵（応接室の扉を開ける）
- [ ] 館長室の鍵
- [ ] 地下室の鍵
- [ ] サキの名札、日記、ペンダント（ストーリー用）

### 4.3 謎解き処理
- [ ] 金庫・パスワード入力 UI
- [ ] 書庫の暗号（展示室番号 × 創設年 1964 の各位）の計算・判定
- [ ] 館長室の隠し金庫（絵画 No.29 を掛けると出現）
- [ ] 廊下ボードのヒント表示
- [ ] 謎解き成功時のフラグ設定・次処理への遷移

### 4.4 ドア・扉処理
- [ ] 鍵で開く扉の判定（所持アイテムと扉の紐付け）
- [ ] 扉を開けた後の部屋への遷移
- [ ] 鍵が無い場合のメッセージ表示

---

## Phase 5：イベント・ストーリー

### 5.1 イベントトリガー
- [ ] 特定の部屋進入時のイベント発生
- [ ] 純鬼初出現（休憩室・ソファの下で鍵取得時）
- [ ] 階段踊り場での純鬼出現
- [ ] 地下室での主な純鬼出現

### 5.2 選択肢処理
- [ ] 選択肢 UI の表示（例：「逃げる」「触れる」）
- [ ] 選択に応じた分岐処理
- [ ] トゥルーエンド用「触れる」選択の実装

### 5.3 テキスト・メッセージ
- [ ] 日記やメモの表示 UI
- [ ] サキのペンダント内メモの表示
- [ ] 取得アイテムの説明文表示

---

## Phase 6：DB（SQLite）・セーブ

### 6.1 DB 初期化
- [ ] SQLite 接続処理（`sqlite3.connect()`）
- [ ] セーブデータ用テーブルの作成
- [ ] テーブル定義（プレイヤー位置、所持アイテム、進行フラグ、エンディング到達状況など）

### 6.2 セーブ処理
- [ ] セーブポイントの定義（特定の部屋やアイテム使用時）
- [ ] 現在のゲーム状態を DB に書き込み
- [ ] セーブ成功時のフィードバック表示

### 6.3 ロード処理
- [ ] タイトル画面 or メニューからロード選択
- [ ] DB からセーブデータを読み込み
- [ ] プレイヤー位置、アイテム、進行フラグを復元
- [ ] ロード後のゲーム再開

### 6.4 その他 DB 処理
- [ ] 設定の保存（音量、操作設定）※任意
- [ ] 実績・エンディング到達状況の記録 ※任意

---

## Phase 7：サウンド・演出

### 7.1 BGM
- [ ] BGM ファイルの読み込み（`pygame.mixer.music`）
- [ ] 通常探索用 BGM の再生
- [ ] 純鬼出現時の BGM 切り替え（緊張感のある曲）
- [ ] BGM のループ、停止、ボリューム調整

### 7.2 効果音（SE）
- [ ] 足音 SE の再生（歩行時）
- [ ] ドアを開ける SE
- [ ] アイテム取得 SE
- [ ] ゲームオーバー SE
- [ ] 純鬼出現時の SE

### 7.3 画面演出
- [ ] 懐中電灯の照明効果（暗闘中の視界範囲）
- [ ] 純鬼出現時の暗転・フラッシュ
- [ ] フェードイン・フェードアウト（シーン転換）

---

## Phase 8：UI・エンディング

### 8.1 ゲーム内 UI
- [ ] インベントリ表示（所持アイテム一覧）
- [ ] ヒント・メッセージ表示エリア
- [ ] 残り電池（懐中電灯）の表示 ※任意

### 8.2 タイトル・メニュー
- [x] タイトル画面の表示（`src/ui/draw.py` の `draw_title_screen`）
- [ ] 「はじめる」「つづきから」「終了」などのメニュー
- [ ] メニュー選択と遷移処理

### 8.3 エンディング処理
- [ ] 脱出成功の判定（屋上から外へ）
- [ ] エンディング分岐の判定（トゥルー / ノーマル / バッド）
- [ ] 「覚悟」（トゥルー）エンディング：純鬼に触れた後、サキの記憶シーン
- [ ] 「脱出」（ノーマル）エンディング：脱出のみ
- [ ] 「囚われ」（バッド）エンディング：ゲームオーバー時の代わり or 条件付き
- [ ] エンディング画面の表示
- [ ] タイトルに戻る処理

---

## Phase 9：テスト・調整

### 9.1 動作確認
- [ ] 全エリアのマップ遷移が正常に動作する
- [ ] 全アイテムが取得可能
- [ ] 全謎解きが解ける
- [ ] 純鬼の追跡・接触判定が正しく動作する
- [ ] セーブ / ロードが正常に動作する

### 9.2 バランス調整
- [ ] 純鬼の移動速度の調整
- [ ] 出現タイミングの調整
- [ ] BGM / SE のボリューム調整

### 9.3 バグ修正
- [ ] 壁抜け、不当なゲームオーバーなどの不具合修正
- [ ] メモリリーク、クラッシュの有無確認

---

## 補足：処理フロー図

ソースコードの処理の流れの詳細は **[処理フロー図.md](処理フロー図.md)** を参照してください。

- 全体フロー（起動～終了）
- メインゲームループ詳細
- プレイヤー処理、純鬼 AI、アイテム・謎解き
- セーブ/ロード、エンディング分岐
- モジュール依存関係

---

## 開発環境

- **Python**: 3.14.2
- **venv**: 仮想環境
- **Pygame**: 2.5.x 以上

---

*以上、純鬼 処理チェックリスト*
